[[vm-placement-during-provisioning]]
== Расположение виртуальной машины во время обеспечения

Процесс принятия решения, где в нашей виртуальной инфраструктуре позиционировать новую виртуальную машину - гипервизор или кластер, а также дата -хранилище - это еще один шаг, который может быть автоматизирован как часть рабочего процесса, обеспечивающего виртуальную машину. Возможно, мы хотели бы найти виртуальные машины на кластере с помощью самой легкой тока нагрузки, например, или ограничить видимость выбранных данных данных некоторым пользователям.

Cloudforms и Manageiq ссылаются на этот процесс как _placement_, и есть соответствующая * стадия размещения * в машине состояния _vmprovision_vm_.

В этой главе мы рассмотрим различные варианты автоматизации размещения и то, как мы можем создавать индивидуальные алгоритмы размещения в соответствии с нашими собственными требованиями.

=== Placement Methods

Существует несколько альтернативных методов размещения, которые мы можем использовать вне коробки, чтобы определить, где разместить наши новые виртуальные машины, например, в домене _manageiq_ (см. << i1 >>).

[[i1]]
. Методы размещения в домене управления
image::images/ss2.png[Screenshot,350,align="center"]
{zwsp} +

Значение по умолчанию для стадии размещения * в машине состояния _vmprovision_vm/template_ выглядит следующим образом:

----
/Infra.../vm/provisioning/placement/default#$ помощью/#miq_provision.source.vendor}
----

Мы видим, что этот URI включает в себя компонент _message_ в конце, который соответствует значению времени выполнения `$ {/#miq_provision.source.vendor}` атрибут. Это строковое значение для типа поставщика, к которому мы предоставляем.

Если мы посмотрим на поля схемы в экземпляре _/Infrastructure/VM/Provisioning/Placement/default_ Platement, мы видим, что сообщения соответствуют той же строке типа поставщика: 'redhat', 'vmware' или 'microsoft' (см. << i2 >>).

[[i2]]
. Поля экземпляра размещения по умолчанию
image::images/ss1.png[Screenshot,500,align="center"]
{zwsp} +

Это аккуратный способ обработки требований к размещению, специфичными для поставщика, автоматизированным образом. Сообщение динамически переводится для каждой операции обеспечения, и это выбирает правильный метод размещения.

=== Method Description
Метод _redhat_best_fit_cluster_ просто помещает новую виртуальную машину в тот же кластер, что и шаблон источника. Два других метода выбирают хост с наименее запущенными виртуальными машинами и наиболее доступным пространством данных.

=== Customising Placement

В рамках дополнительного значения, которое CloudForms приносит Manageiq, домен _redhat_ включает в себя улучшенные методы размещения, которые мы можем использовать, см. << i3 >>).

[[i3]]
. Методы размещения в домене Redhat
image::images/ss4.png[Screenshot,380,align="center"]
{zwsp} +

Методы _WITH_SCOPE позволяют нам применить тег из категории тегов `prov_scope` (racope) к выбранным хостам и данных. Этот тег указывает, должны ли они быть включены для рассмотрения для автоматического размещения виртуальной машины. Тег `prov_scope` должен быть` all` или именем группы пользователей CloudForms. Помежавая имя группы, мы можем направлять выбранные рабочие нагрузки (например, виртуальные машины разработчиков) на определенные хосты и данные данных.

Метод vmware_best_fit_with_tags рассматривает любой хост или хранилище данных с тем же тегом, что и запрос на предоставление; То есть выбрано из вкладки «Цель» в диалоговом окне «Предоставление».

Все три метода домена _redhat_ также позволяют нам устанавливать пороговые значения для использования хранилища данных с точки зрения процента использования и количества существующих виртуальных машин при рассмотрении данных для размещения.

[role="pagebreak-before"]
==== Using Alternative Placement Methods

Чтобы использовать методы размещения домена _redhat_ (или любые другие, которые мы выбираем, мы копируем экземпляр _manageiq/Infrastructure/VM/Provisioning/Placement/default_ в нашем собственном домене и редактируем значение для `Redhat`,` vmware` или `microsoft schema schema, соответствующих, чтобы указать метод предпочтения.

[[i4]]
. Редакция экземпляра размещения/по умолчанию
image::images/ss3.png[Screenshot,750,align="center"]
{zwsp} +

Например, если мы хотели бы использовать метод размещения rhev из домена _redhat_, мы установили бы значение поля Redhat` Schema как `redhat_best_placement_with_scope`.

=== Summary

Мы видим, что у нас есть много контроля за провайдерами, доступными нам, когда мы предоставляем виртуальную машину. Мы также можем добавить наши собственные методы размещения, чтобы принять во внимание наши собственные конкретные требования, если мы пожелаем.

Когда мы начинаем работать с методами пользовательского размещения, нам также необходимо учитывать компоненты инфраструктуры, которые пользователь может видеть из своих фильтров управления доступа на основе ролей. Когда мы настраиваем группы CloudForms или Manageiq доступа, мы можем установить дополнительные _assigned filters_ на выбранные хосты и кластеры. Мы также можем ограничить видимость группы компонентов инфраструктуры, которые тегиты с конкретными тегами. Если мы используем назначенные фильтры таким образом, мы должны убедиться, что наша логика размещения не выберет хост, кластер или хранилище данных, которое пользователь не имеет разрешения RBAC, в противном случае операция по обеспечению провальной.

==== Further Reading

http://cloudformsblog.redhat.com/2013/09/06/placement-profile-best-fit-cluster-using-tags/цин Профиль-Best Fit Cluster с использованием тегов]
