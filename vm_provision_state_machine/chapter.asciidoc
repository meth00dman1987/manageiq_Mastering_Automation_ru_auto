[[vm-provision-state-machine]]
== Машина для обеспечения государственного обеспечения

До сих пор в части II мы изучили специфическую обработку контрольной группы, связанную с обеспечением виртуальной машины. Мы видели, как обрабатываются одобрение и квоты, и как записи из диалога Provisioning WebUI добавляются в объекты запроса и задачи в хэш с вариантами.

Общий рабочий процесс для обеспечения виртуальных машин обрабатывается с помощью состояния _vm.

Каждый из рабочих процессов провинции виртуальной машины и экземпляра контролируется машиной государства VM в соответствующих пространствах _infrastructure_ и _cloud_ имен. Эти государственные машины определяют шаги в рабочем процессе обеспечения виртуальной машины и содержат гибкие параметры предварительной предварительной и постпровидки. Экземпляры, работающие в рамках этой штатной машины, имеют доступ к объекту задачи по обеспечению через `$ evm.root ['miq_provision']`.

=== State Machine Schema

Схема VM/vm/vm/vm/vm/vm/vm/vm provision matche (_ {cloud/vmprovision_vm_) содержит ряд состояний (см. << i1 >>).

[[i1]]
.Fields of Vmprovision_vm State Machine
image::images/ss1.png["The VMProvision_VM State Machine"]
{zwsp} +

Некоторые из этих состояний (например, *RegisterCmdb *или *RegisterAd *) не содержат необычных значений, но есть ли в качестве заполнители, если мы хотим добавить функциональность в наш собственный индивидуальный экземпляр.

В некоторых штатах (таких как *Prefrovision *) имеют значения, которые включают добавленное сообщение, например:

....
...StateMachines/Methods/PreProvision#${/#miq_provision.source.vendor}
....

Сообщение выбирается во время выполнения из заменителя переменной для `#$ {/#miq_provision.source.vendor}` и позволяет динамический выбор параметров обработки, специфичных для поставщика (в данном случае, позволяя альтернативным параметрам предварительного расширения для VMware, Redhat, Microsoft, Amazon или OpenStack).

=== Filling the Blanks

Мы можем скопировать государственную машину VM Provision в наш собственный домен и добавить URI Encement в любом из пустых состояний по мере необходимости или расширить государственную машину, вставив новые состояния. Распространенным дополнением является добавление метода на шаге * AcceiReipAddress * для извлечения IP -адреса из корпоративного решения IPAM, такого как прибор InfoBlox. После извлечения IP -адрес вставлен в хэш _task's Options с использованием метода `set_option`, например, так:

[source,ruby]
----
$ evm.root ['miq_provision']. set_option (: ip_addr, allocated_ip_address)
----

=== Summary

Машина VM Provisioning Matching является одной из самых сложных, которые мы находим в CloudForms и Manageiq. Существуют версии этой государственной машины как в пространствах /инфраструктуры, так и в облачных именах, и они организуют предварительные шаги в своих соответствующих поставщиках.

Однако государственные машины предназначены для расширения, и мы разработаем эту концепцию в следующей главе, где мы скопируем статусную машину в наш собственный домен и расширим ее, чтобы добавить второй диск в рамках процесса обеспечения.
