[[the-provisioning-dialog]]
== Диалог подготовки

До сих пор в части II мы рассмотрели несколько способов, которыми можно настроить виртуальную машину _process_. Мы видели, как мы можем автоматизировать выбор названия виртуальной машины, решить, где разместить виртуальную машину, и расширить статусную машину, чтобы вставить наши собственные шаги рабочего процесса.

В этой главе будет рассмотрено, как может быть настроен первоначальный диалог, который запустил процесс обеспечения. Мы можем захотеть сделать это, чтобы расширить доступные для нас параметры, или для предварительной фигуры и скрыть другие элементы диалога для определенных групп пользователей.

Спецификация для новой виртуальной машины или экземпляра вводится в диалог _provisioning, который отображается пользователю в веб -сайте. Этот диалоговое окно подсказывает для всех параметров и характеристик, которые будут составлять новую виртуальную машину, такие как имя, количество процессоров и IP -адрес.

=== Tabs and Input Fields

Диалог подготовки содержит ряд вкладок (** Запрос **, ** Цель **, ** Каталог **, ** среда ** и т. Д.), И ряд входных полей на вкладку (см. << i1 >>).

[[i1]]
. Аппаратная вкладка диалога по обеспечению виртуальной машины
image::images/ss1.png[screenshot]
{zwsp} +

Диалог подготовки зависит от контекста, поэтому, например, другой набор параметров поля ввода будет отображаться при обеспечении VMware или OpenStack.

=== Dialog YAML

Каждый диалог подготовки отформатируется из большого (900 LINE+) YAML -файла, указав основные вкладки, диалоги и поля, например:

....
---
:buttons:
- :представлять на рассмотрение
- :отмена
:dialogs:
  :requester:
    :description: Request
    :fields:
      :owner_phone:
        :description: Phone
        :required: false
        :display: :hide
        :data_type: :string
...
      :owner_email:
        :description: E-Mail
        :required: true
        :display: :edit
        :data_type: :string
 ...
   :purpose:
    :description: Purpose
    :fields:
      :vm_tags:
        :required_method: :validate_tags
        :description: Tags
        :required: false
        :options:
          :include: []
...
        :display: :edit
        :required_tags: []
        :data_type: :integer
    :display: :hide
    :field_order:
 ...
 :dialog_order:
-: Запись
- :цель
....

Вкладки и поля диалога имеют четыре полезных атрибута, которые можно установить:

* Скрыт (`: display :: hide`)
* Видимо (`: Display :: Show`)
* Редактируемое (`: display :: edit`)
* Обязательно (`: Требуется: true`)

=== Selection of VM Provisioning Dialog

Несколько диалогов обеспечения виртуальной машины представлены в стороне от CloudForms и Manageiq, каждый из которых обеспечивает контекстную чувствительность для конкретной операции обеспечения. Они найдены под
* Автоматизация -> Настройка* Меню, в диалогах* Provisioning* Аккордеон.

[options="header",]
|=======================================================================
| Имя | Описание
| miq_provision_amazon_dialogs_template | Пример экземпляра Amazon
Диалог обеспечения

| miq_provision_azure_dialogs_template | Пример экземпляра Azure
Диалог обеспечения

| miq_provision_google_dialogs_template | Пример экземпляра Google
Диалог обеспечения

| miq_provision_microsoft_dialogs_template | Пример Microsoft VM
Диалог обеспечения

| miq_provision_openstack_dialogs_template | Пример экземпляра OpenStack
Диалог обеспечения

| miq_provision_redhat_dialogs_clone_to_vm | Образец Redhat VM -клон для VM
Диалог

| miq_provision_redhat_dialogs_template | Пример Redhat VM Provisioning
Диалог

| miq_provision_vmware_dialogs_clone_to_template | Образец виртуальной машины к шаблону
Диалог

| miq_provision_vmware_dialogs_clone_to_vm | Пример виртуальной машины к диалогу с виртуальной машиной

| miq_provision_dialogs_pre_sample | Пример VM Previsioning Dialog

| miq_provision_dialogs | Пример диалога VM Provisioning

| miq_provision_vmware_dialogs_template | Пример диалога VM Provisioning
(Шаблон)
|=======================================================================

Различные диалоги содержат значения, которые имеют отношение к их целевому типу поставщика (Amazon, Azure, Google, OpenStack, Microsoft, VMware или Redhat), а также для типа операции (клон от шаблона, клон к шаблону или клон до виртуальной машины).

Выбор диалогового окна обеспечения виртуальной машины для отображения для пользователя зависит от атрибута * dialog_name * в профиле группы Provisioning. Значение по умолчанию * dialog_name * для профилей _.missing_ и _evmgroup-super_administrator_

....
$ {#dialog_name_prefix} _ $ {/#dialog_input_request_type}
....

Две переменные заменяются во время выполнения и обеспечивают контекстную чувствительность. Значение * dialog_name_prefix * определяется методом _vm_dialog_name_prefix_, который содержит следующий код:

[source,ruby]
----
Платформа = $ evm.root ['платформа']
$ evm.log ("info", "обнаруженная платформа: <#{платформа}>")

Если платформ.nil?
source_id = $ evm.root ['dialog_input_src_vm_id']
Source = $ evm.vmdb ('vm_or_template', source_id), если нет source_id.nil?
Если источник
Platform = source.model_suffix.downcase
еще
платформа = "vmware"
конец
конец

dialog_name_prefix = "miq_provision _#{платформа} _dialogs"
$ evm.object ['dialog_name_prefix'] = dialog_name_prefix
----

Значение * dialog_input_request_type * переводится с помощью класса Rails _miqrequestworkflow_, чтобы быть именем экземпляра машины VM Provisioning Cathing, который мы используем - это, _template_, _clone_to_vm_ или _clone_template_.

Таким образом, для запроса о предоставлении виртуальной машины от шаблона в провайдера rhev, значение * dialog_name * будет заменено следующим образом:

....
miq_provision_redhat_dialogs_template
....

=== Group-Specific Dialogs

Мы можем установить отдельные диалоги для отдельных групп, если мы захотим. В качестве примера диалоговое окно VMware-Specififice _miq_provision_dialogs-user_ представляет собой уменьшенный набор вкладок, диалогов и полей ввода. Скрытые вкладки были даны значения по умолчанию, и _automatic Placement_ было установлено на `true`:

....
      :placement_auto:
        :values:
Неверно: 0
Верно: 1
        :description: Choose Automatically
        :required: false
        :display: :edit
        :default: true
        :data_type: :boolean
....

Мы можем создавать диалоги для первой группы по своему усмотрению, настраивая значения, которые скрыты или установлены в качестве по умолчанию.

==== Example - Expanding the Dialog

В некоторых случаях полезно иметь возможность расширить диапазон параметров, представленных диалогом. Например, стандартные диалоги позволяют нам указать только память VM в единицах 1 ГБ, 2 ГБ или 4 ГБ (см. << i2 >>).

[[i2]]
.Default quired размер памяти
image::images/ss2.png[Screenshot,380,align="center"]
{zwsp} +

[NOTE]
====
CloudForms 4.2/Manageiq _euwe_ увеличил размеры памяти по умолчанию, доступные в этом раскрывающемся списке
====

Эти параметры поступают из разделения диалога `: vm_memory`:

....
      :vm_memory:
        :values:
          '2048': '2048'
          '4096': '4096'
          '1024': '1024'
        :description: Memory (MB)
        :required: false
        :display: :edit
        :default: '1024'
        :data_type: :string
....

Иногда нам нужно иметь возможность обеспечить большие виртуальные машины, но, к счастью, мы можем настроить диалог на наши собственные потребности.

===== Copy the existing dialog

Если мы идентифицируем используемый диалог (в этом примере это _miq_provision_redhat_dialogs_template_, поскольку мы подставляем в rhev с использованием нативного клона), мы можем скопировать диалог, чтобы сделать его редактируемым (мы назваем новую версию _bit63_miq_provision_redhat_dialogs_template_.

Затем мы можем расширить раздел `: vm_memory`, чтобы соответствовать нашим требованиям:

....
      :vm_memory:
        :values:
          '1024': '1024'
          '2048': '2048'
          '4096': '4096'
          '8192': '8192'
          '16384': '16384'
        :description: Memory (MB)
        :required: false
        :display: :edit
        :default: '1024'
        :data_type: :string
....

===== Create a group profile

Теперь мы копируем класс _/инфраструктура/vm/provisioning/profile_ в нашем собственном домене и создаем экземпляр профиля для группы, которую мы хотим назначить новым диалогам, в данном случае * Bit63group-user * (см. << i3 >>).

[[i3]]
. Создание нового экземпляра профиля
image::images/ss3.png[Screenshot,350,align="center"]
{zwsp} +

Поле * dialog_name * в новом профиле должно содержать имя нашего нового диалога (см. << i4 >>).

[[i4]]
.
image::images/ss4.png[Screenshot,500,align="center"]
{zwsp} +

===== Testing the provisioning dialog

Чтобы проверить это, мы входим в систему как пользователь, который является членом группы * Bit63Group-USER * и предоставляем виртуальную машину. Если мы перейдем к вкладке * Hardware * в диалоговом окне обеспечения, мы должны увидеть расширенный диапазон параметров памяти (см. << i5 >>).

[[i5]]
.Expaded диапазон размеров памяти
image::images/ss5.png[Screenshot,380,align="center"]
{zwsp} +

=== Summary

В этой главе мы видели, как используется диалоговое окно обеспечения виртуальной машины и как его можно настроить.

Мы часто создаем специфические для группы диалоги, которые содержат набор параметров предоставления по умолчанию, и мы можем воспользоваться этим, когда мы делаем вызов API для предоставления виртуальной машины, например, в качестве конкретного пользователя. Профиль группы пользователя предоставит значения по умолчанию для виртуальной машины, поэтому нам нужно только указать значения переопределения в наших параметрах вызова API.

